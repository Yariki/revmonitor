var Urls = (function () {
    return {
        Details: 'https://www.rev.com/workspace/project/',
        Claim: 'https://www.rev.com/workspace/ClaimTranslation?projectNumber=',
        RevUrl: 'https://www.rev.com/'
    }
})();

var ResultMessages = (function () {
    return {
        projectIsNotAvailable: 'Project is not available',
    }
})();


var dataResult = "<!DOCTYPE html><html lang=\"en-us\"><head xmlns:og=\"http://ogp.me/ns#\" xmlns:fb=\"http://www.facebook.com/2008/fbml\"> <title>Project - TR0455489508P-1</title> <meta property=\"og:title\" content=\"Project - TR0455489508P-1\"/><meta property=\"og:type\" content=\"website\"/><meta property=\"og:site_name\" content=\"Rev\"/><meta property=\"og:description\" content=\"Online audio transcription, video captions, and document translation services. Serving more than 100k customers worldwide.\"/><meta property=\"og:image\" content=\"https://www.rev.com/content/curve/img/home/rev_twittercard.jpg\"/><meta property=\"og:image:width\" content=\"1200\"/><meta property=\"og:image:height\" content=\"630\"/><meta property=\"og:url\" content=\"https://www.rev.com/workspace/project/TR0455489508P-1\"/><meta property=\"fb:app_id\" content=\"199170300134516\"/><meta property=\"twitter:card\" content=\"summary_large_image\"/><meta property=\"twitter:site\" content=\"@rev\"/> <link rel=\"canonical\" href=\"https://www.rev.com/workspace/project/TR0455489508P-1\"/> <meta name=\"fox:build\" content=\"1335-0\"/> <link rel=\"shortcut icon\" type=\"image/x-icon\" href=\"/content/img/rev/favicon.ico\"/> <meta name=\"robots\" content=\"noindex\"/> <script>window['_fs_debug']=false; window['_fs_host']='fullstory.com'; window['_fs_org']='10Qs'; window['_fs_namespace']='FS'; (function(m,n,e,t,l,o,g,y){if (e in m){if(m.console && m.console.log){m.console.log('FullStory namespace conflict. Please set window[\"_fs_namespace\"].');}return;}g=m[e]=function(a,b){g.q?g.q.push([a,b]):g._api(a,b);};g.q=[]; o=n.createElement(t);o.async=1;o.src='https://'+_fs_host+'/s/fs.js'; y=n.getElementsByTagName(t)[0];y.parentNode.insertBefore(o,y); g.identify=function(i,v){g(l,{uid:i});if(v)g(l,v)};g.setUserVars=function(v){g(l,v)}; g.identifyAccount=function(i,v){o='account';v=v||{};v.acctId=i;g(o,v)}; g.clearUserCookie=function(c,d,i){if(!c || document.cookie.match('fs_uid=[`;`]*`[`;`]*`[`;`]*`')){d=n.domain;while(1){n.cookie='fs_uid=;domain='+d+ ';path=/;expires='+new Date(0).toUTCString();i=d.indexOf('.');if(i<0)break;d=d.slice(i+1)}}};})(window,document,window['_fs_namespace'],'script','user'); </script> <script>window.addEventListener('load', function(){if (window.FS){window.FS.identify('14',{'displayName': 'Svetlana', 'email': 'mirlanochka@gmail.com'});}}); </script><!--[if lt IE 9]> <script src=\"//html5shim.googlecode.com/svn/trunk/html5.js\"></script><![endif]--> <script src=\"/bundles/jquery.js?v=N9X31oj24lli1uVFpX6uj0M2WdN7GdgMjnvYEUoIx7s1\"></script> <script type=\"text/javascript\">window.jQuery || document.write('<script src=\"/build/Vendor/jquery-1.11.1.min.js\"></script>') </script> <script src=\"/bundles/jquery-migrate.js?v=j31sfFtBt-7fsm9fEco4tWwFrmMsyEocgMaQEok1n2k1\"></script> <script type=\"text/javascript\">(function (){var now=new Date(); var offset=0 - now.getTimezoneOffset(); var expire=new Date(); expire.setFullYear(now.getFullYear() + 5); document.cookie='ft_tz=' + escape(offset) + ';expires=' + expire.toGMTString() + ';path=/'})(); </script> <link href=\"/Content/css2/v2/bootstrap3.less?v=1335-0\" type=\"text/css\" rel=\"stylesheet\"/> <script src=\"/build/Vendor/bootstrap3/bootstrap.js?v=680CCB79C8E1423C2548DD5B5DE47C85\" type=\"text/javascript\"></script> <script>(function(){var d=document; var c=d.createElement('script'); if (!('noModule' in c) && 'onbeforeload' in c){var s=false; d.addEventListener('beforeload', function(e){if (e.target===c){s=true;}else if (!e.target.hasAttribute('nomodule') || !s){return;}e.preventDefault();}, true); c.type='module'; c.src='.'; d.head.appendChild(c); c.remove();}}());</script> <script nomodule src=\"/build/polyfills.bundle.js?v=1D8D8980DFC2AF8D1E76EBE448D0EDC5\" type=\"text/javascript\"></script> <script src=\"/bundles/common.js?v=GlkYKQVq_A5l9-o1lCAtkrF17SHkXF6DFtdkgCp8PUE1\"></script> <script src=\"/build/common.bundle.js?v=F1678710DE7265D85F5680C95A5C03EB\" type=\"text/javascript\"></script> <link href=\"/Content/css2/v2/app.less?v=1335-0\" type=\"text/css\" rel=\"stylesheet\"/> <script type=\"text/javascript\">!function(a,b,c,d,e,f,g,h){a.RaygunObject=e,a[e]=a[e]||function(){(a[e].o=a[e].o||[]).push(arguments)},f=b.createElement(c),g=b.getElementsByTagName(c)[0], f.async=1,f.src=d,g.parentNode.insertBefore(f,g),h=a.onerror,a.onerror=function(b,c,d,f,g){h&&h(b,c,d,f,g),g||(g=new Error(b)),a[e].q=a[e].q||[],a[e].q.push({e:g})}}(window,document,\"script\",\"//cdn.raygun.io/raygun4js/raygun.min.js\",\"rg4js\"); rg4js('options',{debugMode: true, ignoreAjaxAbort: true, ignoreAjaxError: true, ignore3rdPartyErrors: true}); rg4js('apiKey', 'eIWQURn3Q+LVjvLWfppMgA=='); rg4js('enableCrashReporting', true); rg4js('withTags', [\"Marketplace\",\"Workspace\"]); rg4js('setUser',{identifier: '14', fullName: 'Svetlana Lisovska', isAnonymous: false}); window.rg4js=rg4js; </script> <link href=\"/Content/css2/v2/workspace/workspace.less?v=1335-0\" type=\"text/css\" rel=\"stylesheet\"/> <script src=\"/bundles/react.js?v=PyzPyu6WyOuHae1m9aIQpgfgrDXQaaaTf9FWsEna35g1\"></script> <script src=\"/bundles/workspace.js?v=AWWtQvwDGUGfQTFaj5OMSCsoKklD6GsDcNBT4tH8hS81\"></script> <script src=\"/build/find-work.bundle.js?v=1001972C83291E7C0D3CCA881A694352\" type=\"text/javascript\"></script> <script src=\"/build/workspace.bundle.js?v=F4638325F7894495479DA2FA29E03CDF\" type=\"text/javascript\"></script> <link href=\"/Content/css2/v2/workspace/project.less?v=1335-0\" type=\"text/css\" rel=\"stylesheet\"/> <link href=\"/Content/css2/workspace/rate.less?v=1335-0\" type=\"text/css\" rel=\"stylesheet\"/> <link href=\"/Content/css2/vendor/rateit.less?v=1335-0\" type=\"text/css\" rel=\"stylesheet\"/> <link href=\"//netdna.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.css\" rel=\"stylesheet\"/> <script src=\"/bundles/fileManagement.js?v=7DcZucS_isMFGNB80_rR-BGMUldmA-GIPiaL3As7X341\"></script> <script type=\"text/javascript\">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-18309154-6', 'auto'); ga('require', 'ecommerce', 'ecommerce.js'); ga('set', '&uid', '14'); if (typeof ga=='undefined') var ga=function(){}; ga('set', 'dimension1', 'Agent'); ga('send', 'pageview'); </script> <script async src=\"https://www.googletagmanager.com/gtag/js?id=AW-1007079899\"></script> <script>window.dataLayer=window.dataLayer || []; function gtag(){dataLayer.push(arguments);}gtag('js', new Date()); gtag('config', 'AW-1007079899'); </script></head><body class=\"app\"> <noscript> <iframe src=\"//www.googletagmanager.com/ns.html?id=GTM-BHMQ\" height=\"0\" width=\"0\" style=\"display: none; visibility: hidden\"></iframe> </noscript> <script>(function(w, d, s, l, i){w[l]=w[l] || []; w[l].push({'gtm.start': new Date().getTime(), event: 'gtm.js'}); var f=d.getElementsByTagName(s)[0], j=d.createElement(s), dl=l !='dataLayer' ? '&l=' + l : ''; j.async=true; j.src='//www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);})(window, document, 'script', 'dataLayer', 'GTM-BHMQ'); </script> <script>window.addEventListener('load', function(){if (window.intercomSettings){window.intercomSettings.email='mirlanochka@gmail.com';}}); </script> <script>(function(d, i, r, e, c, t, l, y){i[r]=i[r] || function(){(i[r].cq=i[r].cq || []).push(arguments)}; l=d.createElement(c); l.id=\"directlyRTMScript\"; l.src=e; l.async=1; y=d.getElementsByTagName(c)[0]; y.parentNode.insertBefore(l, y);})(document, window, \"DirectlyRTM\", \"https://www.directly.com/widgets/rtm/embed.js\", \"script\", \"DOMContentLoaded\"); DirectlyRTM(\"config\",{id: '8a12a3ca55d936230155df9a2fe644a4', displayAskQuestion: false, questionCategory: 'rtm', customTags: [\"directly_rtm\"], metadata:{referrer: document.location.href,userAgent: navigator.userAgent}}); </script> <noscript> <iframe src=\"//www.googletagmanager.com/ns.html?id=GTM-BHMQ\" height=\"0\" width=\"0\" style=\"display: none; visibility: hidden\"></iframe> </noscript> <script>(function(w, d, s, l, i){w[l]=w[l] || []; w[l].push({'gtm.start': new Date().getTime(), event: 'gtm.js'}); var f=d.getElementsByTagName(s)[0], j=d.createElement(s), dl=l !='dataLayer' ? '&l=' + l : ''; j.async=true; j.src='//www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);})(window, document, 'script', 'dataLayer', 'GTM-BHMQ'); </script> <script>window.addEventListener('load', function(){if (window.intercomSettings){window.intercomSettings.email='mirlanochka@gmail.com';}}); </script> <script>!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod? n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n; n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0; t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window, document,'script','https://connect.facebook.net/en_US/fbevents.js'); fbq('init', '658102074251173',{em: 'mirlanochka@gmail.com',}); fbq('track', 'PageView'); </script> <noscript> <img height=\"1\" width=\"1\" style=\"display:none\" src=\"https://www.facebook.com/tr?id=658102074251173&amp;ev=PageView&amp;noscript=1\"/> </noscript> <div id=\"above-the-fold-bg\" class=\"absolute w-100 cover\"></div><div id=\"page\"> <div id=\"main\"> <nav class=\"navbar navbar-static-top\"> <div class=\"container\"> <div class=\"navbar-header pull-left\"> <a class=\"navbar-brand\" href=\"/workspace\"><span class=\"rev-logo\"></span></a> </div><ul class=\"nav\"> <li class=\"dropdown nav-item\" id=\"menu-findwork\"> <a class=\"dropdown-toggle\" data-toggle=\"dropdown\"> Find Work <span class=\"caret\"></span> </a> <ul class=\"dropdown-menu pull-left\"> <li> <a class=\"menu-item\" id=\"findwork-translation\" href=\"/workspace/findwork/Translation\"> Translation </a> </li></ul> </li><li class=\"dropdown nav-item\" id=\"menu-mywork\"> <a class=\"dropdown-toggle\" data-toggle=\"dropdown\"> My Work <span class=\"caret\"></span> </a> <ul class=\"dropdown-menu pull-left\"> <li> <a class=\"menu-item\" href=\"/workspace/mywork\"> My Projects </a> </li><li> <a class=\"menu-item\" href=\"/workspace/earnings\"> Earnings </a> </li><li> <a class=\"menu-item\" href=\"/workspace/EditRequests\"> Edit Requests </a> </li></ul> </li><li class=\"dropdown nav-item\" id=\"menu-help\"> <a class=\"dropdown-toggle\" data-toggle=\"dropdown\"> Help <span class=\"caret\"></span> </a> <ul class=\"dropdown-menu pull-left\"> <li> <a class=\"menu-item\" id=\"nav-item-askourexperts\" onclick=\"DirectlyRTM(&#39;openAskForm&#39;)\"> Ask our Experts </a> </li><li> <a class=\"menu-item\" id=\"nav-item-helpcenter\" href=\"https://rev.zendesk.com/access/login?force_unaltered_return_to=true&amp;return_to=http%3A%2F%2Frev.zendesk.com%2Fhc%2Fen-us\" target=\"_blank\"> Help Center </a> </li></ul> </li><li class=\"nav-item\"> <a href=\"https://forum.rev.com\" id=\"nav-item-forum\" target=\"_blank\" :> Forum </a> </li></ul> <div class=\"pull-right\"> <ul class=\"nav nav-user\"> <li class=\"dropdown nav-item\" id=\"menu-account\"> <a class=\"dropdown-toggle\" data-toggle=\"dropdown\"> Hello, <b>Svetlana</b> <span class=\"caret\"></span> </a> <ul class=\"dropdown-menu pull-right\"> <li> <a class=\"menu-item\" href=\"/account/settings\"> Settings </a> </li><li> <a class=\"menu-item\" href=\"/account/auth/logout\"> Sign Off </a> </li></ul> </li></ul> </div></div></nav><div class=\"nav-breadcrumb\"> <div class=\"container\"> <ul class=\"breadcrumb\"> <li><a href=/workspace/findwork><span class='home-icon'></span></a></li><li>MY WORK</li><li><a href=/workspace/mywork>PROJECTS</a></li><li class=\"active\">TR0455489508P-1</li></ul> </div></div><div class=\"app\"> <div class=\"container\"> <div class=\"new-workspace\"> <div class=\"row\"> <div class=\"col-sm-12\"> <div class=\"oe-state-header oe-deadline\"> <div class=\"btn-group left-btns\"><a class=\"btn btn-secondary-action \" href=\"#\" id=\"get-help-btn\"><span class=\"btn-label\">Get Help</span></a><a class=\"btn btn-secondary-action \" href=\"#\" id=\"unclaim-btn\"><span class=\"btn-label\">Unclaim</span></a> </div><span class=\"oe-state-msg\"> <span class=\"oe-deadline-label\">Due by</span> <span class=\"oe-deadline-date\"></span> <span class=\"oe-deadline-val oe-deadline-ticker\" data-deadline=\"1572253963917\"> </span> <span class=\"oe-deadline-overdue\">- OVERDUE</span> </span> <div class=\"btn-group right-btns\"> </div></div></div></div><div class=\"row\"> <div class=\"col-sm-6\"> <div class=\"section col-equal-height\"> <h1 class=\"header\">Customer Information</h1> <table class=\"oe-summary\"> <tr class=\"oe-summary-row\"> <td class=\"oe-summary-label\">Customer</td><td class=\"oe-summary-detail\"> Anna Panutsa </td></tr><tr class=\"oe-summary-row\"> <td class=\"oe-summary-label\">Customer Comment</td><td class=\"oe-summary-detail oe-highlighted-info\">Name/Place spellings:Name (ФИО) - Anna Panutsa</td></tr></table> </div></div><div class=\"col-sm-6\"> <div class=\"section col-equal-height\"> <h1 class=\"header\">Project Details</h1> <table class=\"oe-summary\"> <tr class=\"oe-summary-row\"> <td class=\"oe-summary-label\">Output</td><td class=\"oe-summary-detail\"> <span class=\"oe-order-type-val\"> Certified PDF </span> </td></tr><tr class=\"oe-summary-row\"> <td class=\"oe-summary-label\">Language Pair</td><td class=\"oe-summary-detail\">ru2en</td></tr><tr class=\"oe-summary-row\"> <td class=\"oe-summary-label\">Document Length</td><td class=\"oe-summary-detail\">1 page(s)</td></tr><tr class=\"oe-summary-row\"> <td class=\"oe-summary-label\">Status</td><td class=\"oe-summary-detail\">Translation claimed </td></tr><tr class=\"oe-summary-row\"> <td class=\"oe-summary-label\">Translation</td><td class=\"oe-summary-detail\">$16.50 Svetlana Lisovska </td></tr></table> </div></div></div><div class=\"row\"> <div class=\"col-md-12\"> <div class=\"section\"><div class=\"oe-files col\" id=\"oe-files\"> <div class=\"clearfix\"> <div class=\"pull-right\"> <a class=\"btn ws-submit manual btn-new-workspace btn-secondary-action\" href=\"https://www.rev.com/document/ordsz/455489508.zip\" id=\"download-files\"><span class=\"btn-label\">Download Files</span></a><div class=\"modal fade \" id=\"zip-building-progress\"><div class=\"modal-dialog\"><div class=\"modal-content\"><div class=\"modal-body\"> <div class=\"alert alert-warning some-links\"> Some of the documents you selected were links, which will not be included in the downloaded ZIP file </div><h2>Building your file&hellip;</h2> <img src=\"/content/img/ajax-loader.gif\" alt=\"spinner\"/></div><div class=\"modal-footer\"></div></div></div></div></div><h3 class=\"col-header header\">Files</h3> </div><div class=\"oe-files-header-row no-gutter row-fluid clearfix\"> <span class=\"oe-files-header span3 col-xs-3\" id=\"files-header-source\"> Sources <div class=\"column-selection\"> <input type=\"checkbox\" class=\"column-checkbox\"/> </div></span> <span class=\"oe-files-header span3 col-xs-3\" id=\"files-header-primary\"> Translations <div class=\"column-selection\"> <input type=\"checkbox\" class=\"column-checkbox\"/> </div></span> </div><div id=\"oe-file-rows\"> <div id=\"oe-file-rows-nonresources\"> <div id=\"oe-file-rows-project\"></div></div></div></div><script type=\"text/x-handlebars-template\" id=\"aws-upload-template\"> <div class=\"awsupload file-mgmt-upload normal-state\" id=\"{{uploadId}}\" data-ftkeybase=\"uploads/2019-10-28/4fdecf83-6554-469b-a811-f3406c4c3724/\" data-ftprefix=\"input-prefix\" data-ftaws-files-name=\"wtf\"> <div class=\"awsupload-files clear\"></div><div class=\"awsupload-container\" id=\"{{uploadId}}-container\"> <span class=\"awsupload-attach\" id=\"{{uploadId}}-attach\">{{uploadLabel}}</span> </div><div class=\"awsupload-template awsupload-file\"> <div class=\"awsupload-fileinfo\"> <span class=\"awsupload-filename\"></span> <div class=\"awsupload-progress\"> <div class=\"awsupload-progress-i\"> <div class=\"awsupload-progress-bar\"></div></div></div><span class=\"awsupload-size\"></span> </div><a class=\"awsupload-remove\" href=\"#\">remove</a> </div></div></script><script type=\"text/x-handlebars-template\" id=\"aws-upload-progress-partial\"> <span class=\"progress-upload\"> <div class=\"awsupload-progress\"> <div class=\"awsupload-progress-bar\"></div><div class=\"awsupload-progress-text\"></div></div></span> <span class=\"progress-length none\">saving file...</span></script><script type=\"text/x-handlebars-template\" id=\"file-row-template\">{{#each items}}<div class=\"file-item-slot span3 col-xs-3 item-{{@key}}\"></div>{{/each}}</script> <script type=\"text/x-handlebars-template\" id=\"primary-agent-actions-template\"> <div class=\"oe-file-primary-actions-placeholder\">{{showAwsUpload \"upload-primary\" source.documentId \"Upload Translation\"}}<div class=\"uploading-state none\">{{> _awsUploadProgress}}</div><span class=\"normal-state submit-translation\">{{#if source.isNoJobOutputRequired}}[Marked as already translated]{{else}}<a href=\"#\" data-action=\"markalreadytranslated\">Mark as already translated</a>{{/if}}</span> </div></script><script type=\"text/x-handlebars-template\" id=\"file-item-template\"> <div class=\"file-icon normal-state\"> <div class=\"normal-state{{fileIconClass}}\" aria-label=\"{{fileIconLabel}}\"></div></div><div class=\"file-details normal-state\"> <span class=\"file-name\">{{#ifViewIsPrimaryAgent}}{{#if activeDraft}}<a href=\"{{transcriptEditorLaunchLink}}\" target=\"_blank\">Open Draft in Editor</a><a href=\"{{transcriptEditorLaunchLink}}\" target=\"_blank\">Open Draft in Editor</a>{{else}}{{{sourceDownloadLink canDownload primaryDownloadUrl name type deleted}}}{{/if}}{{else}}{{#ifViewIsSupportAndArgNotNull activeDraft}}<a href=\"/workspace/ViewTranscription?draftId={{draft.id}}\" target=\"_blank\">View Current Draft</a>{{else}}{{{sourceDownloadLink canDownload primaryDownloadUrl name type deleted}}}{{/ifViewIsSupportAndArgNotNull}}{{/ifViewIsPrimaryAgent}}</span> <br/> <span class=\"file-additional-details\">{{additionalDetailsForFileItem this}}</span>{{#if transcoded}}<div class=\"transcoded-preview none\" id=\"player_{{primaryVariationId}}\">{{#if isAudio}}<audio preload=\"none\"> <source type=\"{{previewPlayerMediaType}}\" src=\"{{primaryDownloadUrl}}\"/> </audio>{{else}}<video preload=\"none\"> <source type=\"video/mp4\" src=\"{{primaryDownloadUrl}}\"/> </video>{{/if}}</div>{{/if}}</div><div class=\"uploading-state none\">{{> _awsUploadProgress}}</div><div class=\"file-actions-hidden normal-state dropdown\"> <a class=\"dropdown-toggle\" data-placement=\"bottom\" data-html=\"true\" data-toggle=\"dropdown\" href=\"#\"> </a> <ul class=\"oe-files-actions-list dropdown-menu\" role=\"menu\"></ul> </div>{{#if canDownload}}<div class=\"file-selection normal-state\"> <input type=\"checkbox\" class=\"file-checkbox\" data-document-id=\"{{documentId}}\" data-document-revision=\"{{documentRevision}}\" data-file-id=\"{{primaryVariation.id}}\"/> </div>{{/if}}<div class=\"file-actions normal-state\"> <a class=\"file-actions-arrow\" href=\"#\"> <b class=\"caret\"></b> </a> </div></script><script type=\"text/x-handlebars-template\" id=\"upload-new-version-partial\"> <li role=\"presentation\" class=\"upload-action\">{{showAwsUpload \"upload\" documentId action}}</li></script><script type=\"text/x-handlebars-template\" id=\"add-output-doc-partial\"> <li role=\"presentation\" class=\"upload-action\">{{showAwsUpload \"add-output-doc\" documentId action}}</li></script><script type=\"text/x-handlebars-template\" id=\"launch-text-editor-partial\"> <li role=\"presentation\" data-action=\"{{dataAttrForAction action}}\"> <a class=\"menuitem\" href=\"#\">{{#if draft}}Open Draft in Text Editor{{else}}{{#if hasEditorOutputs}}Edit Document in Text Editor{{else}}Launch Text Editor{{/if}}{{/if}}</a> </li></script><script type=\"text/x-handlebars-template\" id=\"file-actions-dropdown-template\">{{#if allowedActions}}<h5>Actions</h5>{{#each allowedActions}}{{#renderActionItem ../this}}<li role=\"presentation\" data-action=\"{{dataAttrForAction this}}\"> <a class=\"menuitem\" href=\"#\">{{this}}</a> </li>{{/renderActionItem}}{{/each}}<li role=\"presentation\" class=\"divider\"></li>{{/if}}{{#if hasMultipleAlternativeVariations}}{{!-- No draft, but has multiple variations (media source) --}}<h5>Alternative Formats</h5> <li class=\"file-variation\">{{{sourceDownloadLink canDownload primaryVariation.downloadUrl primaryVariation.name type deleted}}}<br/> (<strong>Primary</strong>,{{primaryVariation.versionInfo}},{{#ifIsSpeakerReconciledFile primaryVariation.flags}}Speakers Reconciled,{{/ifIsSpeakerReconciledFile}}Uploaded on{{formatDate primaryVariation.uploadedOn \"dd-NNN-yy HH:mm\"}}{{#if primaryVariation.size}},{{formatBytes primaryVariation.size}}{{/if}}) </li>{{#each alternativeVariations}}<li class=\"file-variation\">{{{sourceDownloadLink ../this.canDownload this.downloadUrl this.name ../this.type deleted}}}<br/> ({{this.versionInfo}}{{#if this.frameRate}},{{this.truncatedFrameRate}}fps{{/if}}{{#ifIsSpeakerReconciledFile this.flags}}, Speakers Reconciled{{/ifIsSpeakerReconciledFile}}{{#ifIsAlignmentFile this.flags}}, Auto-Aligned{{/ifIsAlignmentFile}}{{#ifBurntInTimecodesSynced this.flags}}, BITC{{/ifBurntInTimecodesSynced}}, Uploaded on{{formatDate this.uploadedOn \"dd-NNN-yy HH:mm\"}}{{#if this.size}},{{formatBytes this.size}}{{/if}}) </li>{{/each}}{{#if showPreviousRevisions}}{{#if hasPreviousRevisions}}<h5>Previous Versions</h5>{{#each previousRevisions}}<li class=\"file-variation\">{{{sourceDownloadLink this.allowDownloads this.downloadUrl this.name this.type deleted}}}<br/> ({{#ifIsSpeakerReconciledFile this.flags}}Speakers Reconciled,{{/ifIsSpeakerReconciledFile}}{{#ifIsAlignmentFile this.flags}}Auto-Aligned,{{/ifIsAlignmentFile}}{{#ifBurntInTimecodesSynced this.flags}}BITC,{{/ifBurntInTimecodesSynced}}Uploaded on{{formatDate this.uploadedOn \"dd-NNN-yy HH:mm\"}}{{#if this.size}},{{formatBytes this.size}}{{/if}}) </li>{{/each}}{{/if}}{{/if}}{{else}}{{#if showPreviousRevisions}}{{!-- Previous and current version are listed under \"Versions\" --}}<h5>Versions</h5> <li class=\"file-variation\">{{{sourceDownloadLink canDownload primaryVariation.downloadUrl primaryVariation.name type deleted}}}<br/> ({{#unless activeDraft}}<strong>Latest</strong>,{{/unless}}{{#ifIsSpeakerReconciledFile this.flags}}Speakers Reconciled,{{/ifIsSpeakerReconciledFile}}{{#ifIsAlignmentFile primaryVariation.flags}}Auto-Aligned,{{/ifIsAlignmentFile}}{{#ifBurntInTimecodesSynced primaryVariation.flags}}BITC,{{/ifBurntInTimecodesSynced}}Uploaded on{{formatDate primaryVariation.uploadedOn \"dd-NNN-yy HH:mm\"}}{{#if primaryVariation.size}},{{formatBytes primaryVariation.size}}{{/if}}</li>{{#each previousRevisions}}<li class=\"file-variation\">{{{sourceDownloadLink this.allowDownloads this.downloadUrl this.name ../this.type this.deleted}}}<br/> ({{#ifIsSpeakerReconciledFile this.flags}}Speakers Reconciled,{{/ifIsSpeakerReconciledFile}}{{#ifIsAlignmentFile this.flags}}Auto-Aligned,{{/ifIsAlignmentFile}}{{#ifBurntInTimecodesSynced this.flags}}BITC,{{/ifBurntInTimecodesSynced}}Uploaded on{{formatDate this.uploadedOn \"dd-NNN-yy HH:mm\"}}{{#if this.size}},{{formatBytes this.size}}{{/if}}) </li>{{/each}}{{else}}{{!-- One variation of one working version - for source files as-is shown to agents --}}<h5>Work Version</h5> <li class=\"file-variation\">{{{sourceDownloadLink canDownload primaryVariation.downloadUrl primaryVariation.name type deleted}}}<br/> (Uploaded on{{formatDate primaryVariation.uploadedOn \"dd-NNN-yy HH:mm\"}}{{#if primaryVariation.size}},{{formatBytes primaryVariation.size}}{{/if}}</li>{{/if}}{{/if}}</script> <script type=\"text/x-handlebars-template\" id=\"draft-template\"> <div class=\"oe-file-item transcription-draft\"> <div class=\"file-icon normal-state\"> <div class=\"normal-state doc draft\"></div></div><div class=\"file-details normal-state\"> <span class=\"file-name\">{{#ifViewIsPrimaryAgent}}<a href=\"{{transcriptEditorLaunchLink}}\" target=\"_blank\">Open Draft in Editor</a>{{else}}<a href=\"/workspace/ViewTranscription?draftId={{draft.id}}\" target=\"_blank\">View Current Draft</a>{{/ifViewIsPrimaryAgent}}</span> <br/> <span class=\"file-additional-details\"> Draft modified:{{formatDate draft.updatedOn \"dd-NNN-yy HH:mm\"}}</span> </div><div class=\"uploading-state none\">{{> _awsUploadProgress}}</div></div></script><script type=\"text/javascript\">$(function (){var awsConfig={maxFileSize: fileManagement.SupportUploadSizeLimit, policyRedirect: 'eyJleHBpcmF0aW9uIjoiMjAxOS0xMC0yOVQwNjo0Mjo0NFoiLCJjb25kaXRpb25zIjpbeyJhY2wiOiJwcml2YXRlIn0seyJidWNrZXQiOiJ3d3cyLWZveHRyYW5zbGF0ZSJ9LFsic3RhcnRzLXdpdGgiLCIka2V5IiwidXBsb2Fkcy8yMDE5LTEwLTI4LzRmZGVjZjgzLTY1NTQtNDY5Yi1hODExLWYzNDA2YzRjMzcyNC8iXSxbImNvbnRlbnQtbGVuZ3RoLXJhbmdlIiwiMSIsIjUzNjg3MzA2MjQiXSxbInN0YXJ0cy13aXRoIiwiJHgtYW16LW1ldGEtZmlsZW5hbWUiLCIiXSxbInN0YXJ0cy13aXRoIiwiJHN1Y2Nlc3NfYWN0aW9uX3N0YXR1cyIsIjIwMSJdLFsic3RhcnRzLXdpdGgiLCIkbmFtZSIsIiJdLFsic3RhcnRzLXdpdGgiLCIkRmlsZW5hbWUiLCIiXSxbInN0YXJ0cy13aXRoIiwiJENvbnRlbnQtVHlwZSIsIiJdLFsiZXEiLCIkc3VjY2Vzc19hY3Rpb25fcmVkaXJlY3QiLCJodHRwczovL3d3dy5yZXYuY29tL3VwbG9hZC9hd3MtY29tcGxldGUiXV19', signatureRedirect: '7GCs0MeD3zDftngAN+Pd1MXV+/s=', policy201: 'eyJleHBpcmF0aW9uIjoiMjAxOS0xMC0yOVQwNjo0Mjo0NFoiLCJjb25kaXRpb25zIjpbeyJhY2wiOiJwcml2YXRlIn0seyJidWNrZXQiOiJ3d3cyLWZveHRyYW5zbGF0ZSJ9LFsic3RhcnRzLXdpdGgiLCIka2V5IiwidXBsb2Fkcy8yMDE5LTEwLTI4LzRmZGVjZjgzLTY1NTQtNDY5Yi1hODExLWYzNDA2YzRjMzcyNC8iXSxbImNvbnRlbnQtbGVuZ3RoLXJhbmdlIiwiMSIsIjUzNjg3MzA2MjQiXSxbInN0YXJ0cy13aXRoIiwiJHgtYW16LW1ldGEtZmlsZW5hbWUiLCIiXSxbInN0YXJ0cy13aXRoIiwiJHN1Y2Nlc3NfYWN0aW9uX3N0YXR1cyIsIjIwMSJdLFsic3RhcnRzLXdpdGgiLCIkbmFtZSIsIiJdLFsic3RhcnRzLXdpdGgiLCIkRmlsZW5hbWUiLCIiXSxbInN0YXJ0cy13aXRoIiwiJENvbnRlbnQtVHlwZSIsIiJdXX0=', signature201: 'Ux410lQBgELNR46zSYl1X1CQ5ns=', uploadUrl: 'https://www2-foxtranslate.s3.amazonaws.com/', bucket: 'www2-foxtranslate', uploadDir: 'uploads/2019-10-28/4fdecf83-6554-469b-a811-f3406c4c3724/', accessKeyId: 'AKIAJP7E3BY3JPPBAPMA', successRedirect: 'https://www.rev.com/upload/aws-complete'}; var fileManagementParams={view: 2, currentUserIsLastActiveAgent: true, awsConfig: awsConfig, existingFileRows: [{\"source\":{\"documentId\":52153813,\"documentRevision\":0,\"derivedFromId\":null,\"derivedFromRevision\":null,\"projectId\":15180479,\"orderId\":11015648,\"type\":2,\"flags\":0,\"outputOfJobType\":null,\"outputOfJobId\":null,\"wordCount\":null,\"audioLength\":null,\"deleted\":false,\"variations\":[{\"id\":93042794,\"obfuscatedId\":923917249,\"size\":389337,\"name\":\"Прививочная карта (1).jpg\",\"uploadedOnString\":\"2019-10-27T18:41:43.1\",\"flags\":0,\"contentType\":null,\"externalUrl\":null,\"storageKey\":\"[www2-foxtranslate]docs2/56e40412-98f2-44f0-a767-fedd02e6da3f/Прививочная карта (1).jpg\",\"storageKeyHash\":\"313383158120130f3257d7244eac9651e3afbecd72ae17c3544a2dbced63627f\",\"frameRate\":null}],\"primaryVariationId\":93042794,\"cpAttributes\":{\"masterCaptionDocId\":null},\"resourceForId\":null,\"resourceForRevision\":null},\"primary\":null,\"review\":null,\"finished\":null}], outputDocumentInfo:{}, previousRevisionsLookup:{}, draft:{\"id\":0,\"logicalDocumentId\":0,\"logicalDocumentRevision\":0,\"updatedOn\":\"0001-01-01T00:00:00\"}, order:{\"type\":1,\"id\":11015648,\"orderNumber\":\"TR0455489508\",\"state\":190,\"documents\":[{\"documentId\":52153813,\"documentRevision\":0,\"derivedFromId\":null,\"derivedFromRevision\":null,\"projectId\":15180479,\"orderId\":11015648,\"type\":2,\"flags\":0,\"outputOfJobType\":null,\"outputOfJobId\":null,\"wordCount\":null,\"audioLength\":null,\"deleted\":false,\"variations\":[{\"id\":93042794,\"obfuscatedId\":923917249,\"size\":389337,\"name\":\"Прививочная карта (1).jpg\",\"uploadedOnString\":\"2019-10-27T18:41:43.1\",\"flags\":0,\"contentType\":null,\"externalUrl\":null,\"storageKey\":\"[www2-foxtranslate]docs2/56e40412-98f2-44f0-a767-fedd02e6da3f/Прививочная карта (1).jpg\",\"storageKeyHash\":\"313383158120130f3257d7244eac9651e3afbecd72ae17c3544a2dbced63627f\",\"frameRate\":null}],\"primaryVariationId\":93042794,\"cpAttributes\":{\"masterCaptionDocId\":null},\"resourceForId\":null,\"resourceForRevision\":null}]}, allDerivedFromIds: [], sourceDownloadDisabled: 'False'.toLowerCase()==='true', allowAtlasCorrections: 'False'.toLowerCase()==='true'}; fileManagementParams.project={\"type\":1,\"id\":15180479,\"projectNumber\":\"TR0455489508P-1\",\"state\":300,\"documents\":[{\"documentId\":52153813,\"documentRevision\":0,\"derivedFromId\":null,\"derivedFromRevision\":null,\"projectId\":15180479,\"orderId\":11015648,\"type\":2,\"flags\":0,\"outputOfJobType\":null,\"outputOfJobId\":null,\"wordCount\":null,\"audioLength\":null,\"deleted\":false,\"variations\":[{\"id\":93042794,\"obfuscatedId\":923917249,\"size\":389337,\"name\":\"Прививочная карта (1).jpg\",\"uploadedOnString\":\"2019-10-27T18:41:43.1\",\"flags\":0,\"contentType\":null,\"externalUrl\":null,\"storageKey\":\"[www2-foxtranslate]docs2/56e40412-98f2-44f0-a767-fedd02e6da3f/Прививочная карта (1).jpg\",\"storageKeyHash\":\"313383158120130f3257d7244eac9651e3afbecd72ae17c3544a2dbced63627f\",\"frameRate\":null}],\"primaryVariationId\":93042794,\"cpAttributes\":{\"masterCaptionDocId\":null},\"resourceForId\":null,\"resourceForRevision\":null}]}; fileManagementParams.job={\"id\":25453314,\"jobType\":0,\"agentId\":14,\"unclaimWindowMinutes\":60}; fileManagementParams.agentNameForCurrentUser=\"\"; fileManagementParams.isClaimable='False'.toLowerCase()==='true'; fileManagementParams.qualificationLevel='regular'; fileManagement.initializeObjects(fileManagementParams); $('[data-toggle=\"tooltip\"]').tooltip();});</script> </div></div></div><div class=\"row\"> <div class=\"col-md-12\"> <div class=\"oe-comments section\"> <h1 class=\"header\">Comments</h1> <div class=\"row\"> <div class=\"col-sm-8\"> </div><div class=\"col-sm-4\"> <h1>History</h1> <div class=\"oe-history-item project-comment\" id=\"oe-history-item-p-3\"> <div>Translation Claimed</div><div> 8:42 AM - Oct-28-2019 </div></div></div></div></div></div></div></div><div class=\"modal fade \" id=\"unclaim-tr-modal\"><div class=\"modal-dialog\"><div class=\"modal-content\"><div class=\"modal-header\"><button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-hidden=\"true\"></button><h3>Unclaim</h3></div><div class=\"modal-body\"> <form class=\"oe-unclaim\" method=\"post\" action=\"/Workspace/UnclaimTranslationJob?projectNumber=TR0455489508P-1\"> <input name=\"__RequestVerificationToken\" type=\"hidden\" value=\"7dDCm6ONq9P93ZfcoPcFIcx4l2wE0JH4qcXZb75Mizvq7y0LXDEcep0sLXdaOBrz8xne-cZF4rNNLw56J1E0EGgFuYi3O1VAlZ3cWGCiX9kx875j0\"/> <div class=\"unclaim-msgs\"> <h1>Why do you want to unclaim the project?</h1> <div class=\"oe-comment-box padded\"> <textarea class=\"oe-comment-textarea\" cols=\"20\" id=\"Comment\" name=\"Comment\" placeholder=\"Please explain why (required)\" rows=\"2\"></textarea> </div><a class=\"btn ws-submit disabled btn-std\" href=\"#\"><span class=\"btn-label\">Unclaim Project</span></a> </div></form></div><div class=\"modal-footer\"></div></div></div></div><div class=\"modal fade \" id=\"flag-tr-problem-modal\"><div class=\"modal-dialog\"><div class=\"modal-content\"><div class=\"modal-header\"><button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-hidden=\"true\"></button><h3>Report Problem</h3></div><div class=\"modal-body\"> <form class=\"oe-problem\" method=\"post\" data-ordertype=\"Translation\" action=\"/workspace/FlagTranslationProblem?projectNumber=TR0455489508P-1\"> <input name=\"__RequestVerificationToken\" type=\"hidden\" value=\"0U4_3sg1crjY7dDgMqBcPbNsitfZvZwesgNS9RntI36axulEb3rlmaPlIhzKTva-J8Xjai5F3aMJJiggYyYxW96ZMUoZiPTdxYewGfWwNRZRvjd60\"/> <h1>What is the problem?</h1> <ul> <li> <label class=\"radio report-problem-modal\"> <input type=\"checkbox\" name=\"Types\" value=\"WrongLanguagePair\"> Wrong language </label> </li><li> <label class=\"radio report-problem-modal\"> <input type=\"checkbox\" name=\"Types\" value=\"Underpriced\"> Underpriced project<div class=\"underpriced-reasons-container none\"> <ul class=\"unstyled underpriced-reasons-list\"> <li> <label class=\"radio\"> <input type=\"checkbox\" name=\"UnderpricedReasons\" value=\"HighWordDensity\"> High word density </label> </li><li> <label class=\"radio\"> <input type=\"checkbox\" name=\"UnderpricedReasons\" value=\"TechnicalContent\"> Technical content </label> </li><li> <label class=\"radio\"> <input type=\"checkbox\" name=\"UnderpricedReasons\" value=\"HighFormatting\"> High formatting </label> </li></ul></div></label> </li><li> <label class=\"radio report-problem-modal\"> <input type=\"checkbox\" name=\"Types\" value=\"Unworkable\"> Unworkable project </label> </li></ul> <a class=\"btn btn-std ws-submit disabled\" href=\"#\"><span class=\"btn-label\">Report Problem</span></a> </form></div><div class=\"modal-footer\"></div></div></div></div><div class=\"modal fade \" id=\"get-help-modal\"><div class=\"modal-dialog\"><div class=\"modal-content\"><div class=\"modal-header\"><button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-hidden=\"true\"></button><h3>I need help from Rev Support</h3></div><div class=\"modal-body\"> <form class=\"get-help\" method=\"post\" action=\"/workspace/GetHelp?projectNumber=TR0455489508P-1\"> <input name=\"__RequestVerificationToken\" type=\"hidden\" value=\"lhkXtSZ--2ZwNhEc_5egQSqdwuj5sO02keuSf_D_MCleGWHkNjQQgCyPq7dQsUpKCSNi15LC9vW_E9YeDyXSqIia27uXAK6LWCRtIeYcWu6kYL1y0\"/> <div class=\"oe-comment-box get-help-comment padded\"> <textarea name=\"comment\" class=\"text-box oe-comment-textarea\" placeholder=\"Explain the problem (required)\"></textarea> </div><div class=\"error none\">Please enter a comment explaining the problem</div><a class=\"btn ws-submit disabled btn btn-std\" href=\"#\"><span class=\"btn-label\">Get Help</span></a> <br>or<br><a id=\"mark-underpriced-link\">Mark as Underpriced</a> </form> <form class=\"underpriced-reasons-form none\" method=\"post\" action=\"/workspace/FlagTranslationProblem?projectNumber=TR0455489508P-1\"> <input name=\"__RequestVerificationToken\" type=\"hidden\" value=\"h3hiBy1NxOCPRQy3PY4njQyPm6-5kvVrH3thU5FGCELh2KDi77oJROPRF2bDa33RuDcqKgHB6SWwIwXG7nj4Q_Et1BjikdkY859gyD3NrusDZt7H0\"/> <input type=\"checkbox\" name=\"Types\" value=\"Underpriced\" class=\"none\" checked/><div class=\"underpriced-reasons-container none\"> <ul class=\"unstyled underpriced-reasons-list\"> <li> <label class=\"radio\"> <input type=\"checkbox\" name=\"UnderpricedReasons\" value=\"HighWordDensity\"> High word density </label> </li><li> <label class=\"radio\"> <input type=\"checkbox\" name=\"UnderpricedReasons\" value=\"TechnicalContent\"> Technical content </label> </li><li> <label class=\"radio\"> <input type=\"checkbox\" name=\"UnderpricedReasons\" value=\"HighFormatting\"> High formatting </label> </li></ul></div><div class=\"oe-comment-box get-help-comment padded\"> <textarea name=\"comment\" class=\"text-box oe-comment-textarea\" placeholder=\"Explain the problem (optional)\"></textarea> </div><a class=\"btn ws-submit disabled btn btn-std\" href=\"#\"><span class=\"btn-label\">Submit and unclaim this project</span></a> <br>or<br><a id=\"back-to-get-help-link\">Back to Help Request</a> </form></div><div class=\"modal-footer\"></div></div></div></div></div></div><div class=\"push\"></div></div><footer> <div id=\"footer-bottom\"> <div class=\"container\"> <div class=\"row\"> <div class=\"span3 col-sm-2\">Copyright Rev 2019.</div><div class=\"span4 col-sm-4\"> <a href=\"/about/terms\" rel=\"nofollow\">Terms of Service</a> | <a href=\"/about/privacy\" rel=\"nofollow\">Privacy Policy</a> </div><div class=\"span5 contact-info col-sm-6\">Need help? Email us at: <a href=\"mailto:support@rev.com\" class=\"\">support@rev.com</a> </div></div></div></div></footer> </div><div class=\"popup\" id=\"type-popup\" data-position=\"right\"> <ul> <li>Use the Rev certified template</li><li>Final output: Certified PDF</li></ul> </div><script type=\"text/javascript\">// bind the popup to the anchor var popup=new ft_Tooltip('type-popup'); popup.hover($('.oe-order-type-val'), 'right');</script><script type=\"text/javascript\">$(function (){$('.file-info').popover(); var zipBuildingModal=new ft_Modal(\"zip-building-progress\",{show: false});});</script><script type=\"text/javascript\">$(function (){var ft_page=new ft_AgentProjectDetails(600769263, 'TR0455489508P-1'); ft_RecentlyViewed.registerView('TR0455489508P-1', 'project');}); </script><script type=\"text/javascript\">if (window.TcRookieProgressInit){window.TcRookieProgressInit(14, false);}</script> <script type=\"text/javascript\">$(function(){$('.btn, .os-specific').addClass(window.RevBowser.getOsCssClass()); $('.faq-tooltip-link').popover({html: true, trigger: 'click', content: function(){return $('#' + $(this).data('q')).find('.answer').html();}}); $('.faq-tooltip-link-hover').popover({html: true, trigger: 'manual', animation: false, content: function(){return $('#' + $(this).data('q')).find('.answer').html();}}) .on(\"mouseenter\", function (){var _this=this; $(this).popover(\"show\"); $(this).siblings(\".popover\").on(\"mouseleave\", function (){$(_this).popover('hide');});}).on(\"mouseleave\", function (){var _this=this; setTimeout(function (){if (!$(\".popover:hover\").length){$(_this).popover(\"hide\");}}, 100);}); $('FORM').each(function(){var form=ft_Control.get(this); if (!form) form=new ft_Form(this);}); $('.infotip, .popover-tip').each(function (){$(this).popover();});}); </script> <script type=\"text/javascript\">rev_Mixpanel=new ft_Mixpanel('d24fd33359700c4000bbd1c190f60e32', 'mirlanochka@gmail.com', 'rev', false); </script> <script>$(function(){rev_Mixpanel.trackLinks(\"mixpanel-link\");}); </script> <script type=\"text/javascript\">var MTIProjectId='232a0719-41f6-4af7-91a7-3726538d2e6a'; (function(){var mtiTracking=document.createElement('script'); mtiTracking.type='text/javascript'; mtiTracking.async='true'; mtiTracking.src=('https:'==document.location.protocol?'https:':'http:')+'//fast.fonts.net/t/trackingCode.js'; (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild( mtiTracking );})(); </script> </body></html>";


chrome.runtime.onMessage.addListener(function (request, sender, sendResponse) {
    if (request.action == "show") {
        chrome.tabs.query({active: true},result => {
            if(result.length > 0){
                chrome.pageAction.show(result[0].id);
            }
        });
    }
});

chrome.tabs.onActivated.addListener(activeInfo => {
    chrome.tabs.get(activeInfo.tabId, tab => {
        showPageActionForRev(tab);
    });
});

chrome.tabs.onUpdated.addListener((tabId, changeInfo, tab) => {
    showPageActionForRev(tab);
});

function showPageActionForRev(tab) {
    if(!tab.url.startsWith(Urls.RevUrl)){
        return;
    }
    chrome.pageAction.show(tab.id);
}



var notificationController = (function () {

    var opts = {
        notification: false,
        audioNotification: false,
        soundName: ''
    };

    var iconPath = chrome.extension.getURL('icons/favicon.png');

    chrome.storage.sync.get([Settings.notificationEnabled,
                                   Settings.soundNotificationEnabled,
                                   Settings.soundName],function (items) {

        opts.notification = items[Settings.notificationEnabled] !== undefined && items[Settings.notificationEnabled];
        opts.audioNotification = items[Settings.soundNotificationEnabled] !== undefined && items[Settings.soundNotificationEnabled];
        opts.soundName = items[Settings.soundName] != undefined ? items[Settings.soundName] : '';
    });

    function messageNotification(data) {
        var opt = {
            iconUrl: iconPath,
            type: 'basic',
            title: 'Claimed.',
            message: 'Project <' + data.ProjectId  + '> was claimed!',
        };
        chrome.notifications.create('claimed',opt, function () {});
    }

    function soundNotification() {
        var audio = new Audio(Audios[opts.soundName]);
        audio.play();
    }

    function message(msg) {
        var opt = {
            iconUrl: iconPath,
            type: 'basic',
            title: 'Claimed.',
            message: msg,
        };
        chrome.notifications.create('message',opt, function () {});
    }

    return {
        claimedNotification : function (data) {
            if(opts.notification){
                messageNotification(data);
            }
            if(opts.audioNotification){
                soundNotification();
            }
        },
        foundNotification: function () {
            if(opts.notification){
                var opt = {
                    iconUrl: iconPath,
                    type: 'basic',
                    title: 'Found some projects',
                    message: 'We found some unclaimed projects',
                };
                chrome.notifications.create('found',opt, function () {});
            }
        },
        showMessage: function (msg) {
            message(msg);
        }
    }
})();

var claimController = (function (notification) {
    var _this = this;

    var parseProjects = function (projects) {

        //notification.foundNotification();
        console.log('found some projects');
        for (let i = 0; i < projects.length; i++) {
            console.log([projects[i]]);
        }

        for (let i = 0; i < projects.length; i++) {
            var project = projects[i];
            if(!SupportedTranslations.includes(project.Language)){
                continue;
            }
            console.log(projects[i]);
            $.get(Urls.Details + project.ProjectId, (data, status) => {
                processDetails(data,status,project);
            });
        }
    };

    var processDetails = function(data, status, project){
        console.log(data);
        var doc = (new DOMParser()).parseFromString(data,"text/html"); // TODO: detailsPageSource only for testing purpose, need to parse 'data'
        var detailsPage =  $(doc);
        if(isNoticed(doc)){
            console.log("Project is not available: " + project.ProjectId);
            return;
        }

        var form = $(detailsPage).find(DomStrings.claimForm.formId).first();
        if(form === undefined || form === null){
            return;
        }

        var action =  Urls.Claim + project.ProjectId; //$(form).attr('action');
        //action = action.startsWith(DomStrings.claimForm.revUrl) ? action : DomStrings.claimForm.revUrl + action;
        var dataPost = '';
        var hiddens = $(form).find('input[type=hidden]');
        hiddens.each(function (index, element) {
            dataPost += '&' + $(element).attr('name') + '=' + $(element).attr('value');
        });
        if(action !== undefined && dataPost !== ''){
            $.ajax({
                method:'POST',
                url: action,
                data: dataPost
            })
                .done((data) => {
                    processClaim(data,project);
                })
                .fail((data,status) => {
                    processErrorClaim(data);
                })
        }
    };

    var processClaim = function (data,project) {
        console.log(data);

        if(isError(data)){
            console.log("Project is claimed or not available: " + project.ProjectId);
            return;
        }
        console.log('Done! Project Claimed ');
        notification.claimedNotification(project)
    };

    var processErrorClaim = function (data) {
        console.log('Fail:' + data);
    };

    var isNoticed = function (doc) {
      var noticed = doc.querySelector(DomStrings.detailsNotice);
      return noticed !== null  && noticed.innerText === 'Project is not available';
    };

    var isError = function (data) {
        var doc = (new DOMParser()).parseFromString(data, "text/html");
        var projectIsNotAvailable = data.indexOf(ResultMessages.projectIsNotAvailable);
        var errorPage = doc.querySelector(DomStrings.claimErrorPage);
        return (projectIsNotAvailable !== null && projectIsNotAvailable > 0 ) || errorPage !== null;
    };

    return {
        init: function () {
            chrome.runtime.onMessage.addListener(function (msg, sender, sendResponse) {
                if(msg.message === RevMessages.FreeProjects){
                    parseProjects(msg.payload);
                }
            });
        }
    }

})(notificationController);

var updateController = (function () {
        var registeredTabs = {};

        var isRegistered = function (tabId) {
            return registeredTabs[tabId] !== undefined;
        };

        var getState = function (tabId) {
            var state = registeredTabs[tabId];
            return state;
        };

        var startMonitoring = function(data){
            if(!isRegistered(data.tab.id)){
                registeredTabs[data.tab.id] = new State(data.tab.id, +data.interval);
            }
            var state = registeredTabs[data.tab.id];
            state.interval = +data.interval;
            state.tabUrl = data.tab.url;
            state.isRunning = true;
        };

        var stopMonitoring = function(tabId){
            var state = registeredTabs[tabId];
            if(state !== undefined){
                state.isRunning = false;
            }
        };

        return {
            isRegistered: function (tabId) {
                return isRegistered(tabId);
            },
            getState : function (tabId) {
                return getState(tabId);
            },
            start : function (data) {
                startMonitoring(data);
            },
            stop: function (data) {
                stopMonitoring(data.tab.id);
            }
        }
})();

claimController.init();
